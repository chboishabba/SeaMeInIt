# Afflec Image Pre-processing

Our so-called "Afflec" captures are nothing more than demo stills of Ben Afflec
that we annotated to exercise the measurement pipeline. There is no dedicated
Afflec model hiding behind the scenes—just metadata-packed grayscale fixtures
that help us keep the repository binary-free while still validating the tooling.

The `fit_from_images` pipeline expects those captures to be normalised into
portable graymap (PGM) assets before invoking the CLI.

## Workflow

1. Export the Ben Afflec stills (or your own stand-ins) as calibrated grayscale
   renders.
2. Project the measurements generated by your tooling onto each render.
3. Write the measurement metadata into the PGM header using comment lines that
   follow the format `# measurement:<name>=<value>`.
4. Ensure the raster payload remains ASCII encoded (`P2` mode) so the extractor
   can parse the header without specialised tooling.
5. Save the processed assets to disk and call
   `python -m smii.pipelines.fit_from_measurements --images <paths...>`.

The extractor aggregates measurements from all provided images. When duplicate
measurement names appear across files the numeric values must match; otherwise
execution fails with a `MeasurementExtractionError`.

## Generating Sample Assets

Sample fixtures live in `tests/fixtures/afflec/`. They illustrate how to
annotate images without distributing large binaries. You can regenerate them by
running:

```bash
python - <<'PY'
from pathlib import Path

TEMPLATE = """P2
# measurement:height=170.0
# measurement:chest_circumference=96.5
2 2
255
0 0
0 0
"""

Path("tests/fixtures/afflec/sample_front.pgm").write_text(TEMPLATE, encoding="utf-8")
Path("tests/fixtures/afflec/sample_side.pgm").write_text(
    TEMPLATE.replace("chest_circumference=96.5", "waist_circumference=82.3"),
    encoding="utf-8",
)
PY
```

These files contain enough metadata for automated tests while keeping the
repository binary-free. Replace the measurement names and values with the
outputs from your own pre-processing routine to drive production fits—just
remember that the "Afflec" fixtures are playful stand-ins, not a production
dataset.
